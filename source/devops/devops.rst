DevOps
==========================================


.. contents:: 目次
   :depth: 1
   :local:


目的
------------------------------------------

- 顧客に対して、安定していて、信頼できる、セキュアなサービスを提供する
- 競争地図の急速な変化への対応


DevOpsは、組織の何かを改善しなければならない
------------------------------------------

- **プロジェクト進行のあり方**
- **機能追加しづらく、メンテナンスしずらいプロダクト**

開発vs運用:責務の対立
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- 開発 : できる限り早く機能と変更をデプロイしたい
- 運用 : 本番環境を危険にさらすような変更を入れ込みたいくない

技術的負債
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- 時間経過とともに解決しにくくなる
- 将来の選択肢を狭めていく

３つの悪循環
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**1. 技術的負債の発生**

| 逃げ道を通ることが当たり前になってしまった仕事のあり方であり、
| 時間があればなんとかしますという果たされない約束

- システムの複雑化
- テストコードがない
- ドキュメントのアップデート不備

困ったことに、こういう脆弱な成果物が、もっとも重要な収益装置になっている

**2. 技術的負債の増加**

- 納期優先と妥協
- 技術的負債の解消タイミングがない

**3. 技術的負債の増加が続く**

技術的負債の増加により、あらゆることが少しずつ難しくなっていく

- 仕事の時間の増加
- コミュニケーションの時間の増加
- 密結合なソースによる改修の難しさの増加

**変化させにくくなっている**

- すべてが徐々に困難になっていく


DevOpsのビジネスバリュー
------------------------------------------

機動力 と 信頼性 をともに高めていく

**スループットの指標**

- コードの変更とデプロイ
- コードの変更のデプロイリードタイム

**信頼性の指標**

- 本番デプロイ？不具合発生率？
- サービスの障害発生から復元するためにかかった平均時間

**組織の業績の指標**

- 生産性、マーケットシェア、利益性の目的達成
- 時価総額の増加





アジャイル開発
------------------------------------------


テスト駆動開発
------------------------------------------

- テストコード付きのソースコード

- 自動化テスト

  - ユニットテスト

    - xUnit

  - 結合テスト

    - Selenium


軽量なドキュメント
------------------------------------------

- 脱エクセル

- Markdown ドキュメント

- reST ドキュメント


ソースコード/ドキュメントのバージョン管理
------------------------------------------

- インフラ構築スクリプト

  - CloudFormation / terraform

- コンテナ設定ファイル

  - Docker

    - Dockerfile

    - docker-composer.yml

- ミドルウェア構築スクリプト

  - Ansible

- ビルド スクリプト

  - CodeBuild

    - buildspec.yml

    - スクリプトファイル

- デプロイスクリプト

  - CodeDeploy

    - appspec.yml

    - スクリプトファイル
    
- アプリケーションコード

- テストコード

  - xunit

  - selenium

- データベース スクリプト

  - マイグレーションファイル

- ライブラリ

  - requirement.txt (pip) 

  - composer.json (composer)

  - package.json (npm)

- 設定ファイル

  - php.iniなどの言語設定ファイル

  - OSの設定情報

  - DNSゾーン情報

  - ファイアウォール定義

- 仕様書

  - マークダウン

  - rest ドキュメント

- アプリケーション・コンピュータ・ツールコレクションのマニュアル


クラウドインフラストラクチャ
------------------------------------------

- Infrastructure as Code

  - クラウドサービス

    - AWS / GCP / AZULE

  - インフラ構成管理

    - CloudFormation / Terraform

  - ミドルウェア/設定管理

    - Ansible

  - コンテナ/サーバレス

    - ECS / Docker

    - Lambda / ApiGateway

- 自動復旧

  - EC2AutoScaling


デプロイパイプラインの構築
------------------------------------------

- 継続的CI/CD

- バーション管理システム: GIT

- インフラ構築: CloudFormation

  - 構成/設定前の仮想マシンイメージでコンテナを作る

  - テンプレートから設定ファイルを生成する

  - サーバ、アプリケーション、サービスを再起動する

- ミドルウェア設定: Ansible

  - ミドルウェアのデプロイ、構成/設定を自動化する
  
- ビルド: CodeBuild

  - 自動テスト

  - 静的なソースコードチェック

  - コーティングスタイルチェック

  - ビルド

    - デプロイに適した形でコードをパッケージングする

- デプロイ: CodeDeploy

  - Blue/Greenデプロイ

  - 本番サーバにパッケージやファイルをコピーする

  - データベースのマイグレーションをスクリプト化し自動化する
    
  - システムが動作し、正しく構成/設定されていることを確かめるために自動スモークテストを実行する

  - テストプロシージャを実行する


学習の継続化
------------------------------------------

- バッチサイズを小さくしてフィードバッグを早くする

  - テストの自動化によるフィードバック

  - 
